
import streamlit as st
import joblib
import pandas as pd

model = joblib.load("rf_model.pkl")
encoder = joblib.load("encoder.pkl")

features = [
    "gender", "age", "hospital_name", "diagnosis_code",
    "treatment_name", "insurance_covered", "welfare_support"
]

st.title("ğŸ©º ì˜ë£Œë¹„ ì˜ˆì¸¡ ë„ìš°ë¯¸")

user_input = {}

user_input["gender"] = st.selectbox("ì„±ë³„", ["F", "M"])
user_input["age"] = st.slider("ë‚˜ì´", 20, 90, 50)
user_input["hospital_name"] = st.selectbox("ë³‘ì›ëª…", [
    "ì„œìš¸ì‚¼ì„±ë³‘ì›", "ì„œìš¸ì•„ì‚°ë³‘ì›", "ë¶„ë‹¹ì„œìš¸ëŒ€ë³‘ì›", "ì„¸ë¸Œë€ìŠ¤ë³‘ì›", "ì„œìš¸ì˜ë£Œì›",
    "ê°•ë‚¨ì„±ì‹¬ë³‘ì›", "ì„œìš¸ë°±ë³‘ì›", "í•œì–‘ëŒ€ë³‘ì›", "ê³ ëŒ€ì•ˆì•”ë³‘ì›", "ë³´ë¼ë§¤ë³‘ì›",
    "ë¶€ì‚°ëŒ€ë³‘ì›", "ì „ë‚¨ëŒ€ë³‘ì›", "ì œì£¼ëŒ€ë³‘ì›", "ì¸í•˜ëŒ€ë³‘ì›", "ê°•ë¶ì‚¼ì„±ë³‘ì›",
    "ë™êµ­ëŒ€ì¼ì‚°ë³‘ì›", "í™”ìˆœì „ë‚¨ëŒ€ë³‘ì›", "ì¤‘ì•™ë³´í›ˆë³‘ì›", "ì˜ë‚¨ëŒ€ë³‘ì›", "êµ­ë¦½ì•”ì„¼í„°",
    "ì¸ì œëŒ€ì¼ì‚°ë°±ë³‘ì›", "ì„œìš¸ì„±ëª¨ë³‘ì›"
])
user_input["diagnosis_code"] = st.selectbox("ì§„ë‹¨ ì½”ë“œ", [
    "K35.2", "I10", "C34.1", "J01.0", "E11.9", "N92.5", "K80.2", "I25.1", "F32.0", "N18.3",
    "S06.0", "D64.9", "K40.9", "M54.5", "R10.9", "G43.9", "C61", "J45.0", "I21.9", "O80",
    "L03.0", "C50.9", "R51", "H25.1"
])
user_input["treatment_name"] = st.selectbox("ì¹˜ë£Œëª…", [
    "ê´€ì ˆê²½ ìˆ˜ìˆ ", "ê³ í˜ˆì•• ì§„ë£Œ", "íì•” í•­ì•” ì¹˜ë£Œ", "ë¶€ë¹„ë™ì—¼ ì§„ë£Œ", "ë‹¹ë‡¨ë³‘ ì •ê¸°ê²€ì‚¬",
    "ì›”ê²½ê³¼ë‹¤ ì§„ë£Œ", "ë‹´ë‚­ì ˆì œìˆ ", "í—ˆí˜ˆì„± ì‹¬ì§ˆí™˜ ê²€ì‚¬", "ìš°ìš¸ì¦ ì¹˜ë£Œ", "ë§Œì„± ì‹ ë¶€ì „ íˆ¬ì„",
    "ë‘ë¶€ ì™¸ìƒ ì¹˜ë£Œ", "ë¹ˆí˜ˆ ì¹˜ë£Œ", "íƒˆì¥ ìˆ˜ìˆ ", "ìš”í†µ ë¬¼ë¦¬ì¹˜ë£Œ", "ë³µí†µ ì§„ë‹¨ ë° ê²€ì‚¬",
    "í¸ë‘í†µ ì¹˜ë£Œ", "ì „ë¦½ì„ ì•” ë°©ì‚¬ì„ ì¹˜ë£Œ", "ì²œì‹ ì•½ë¬¼ì¹˜ë£Œ", "ì‹¬ê·¼ê²½ìƒ‰ ì‘ê¸‰ì¹˜ë£Œ", "ìì—°ë¶„ë§Œ",
    "í”¼ë¶€ì—¼ ì¹˜ë£Œ", "ìœ ë°©ì•” ìˆ˜ìˆ ", "ë‘í†µ ì§„ë£Œ", "ë°±ë‚´ì¥ ìˆ˜ìˆ "
])
user_input["insurance_covered"] = st.radio("ë³´í—˜ ì ìš© ì—¬ë¶€", ["Y", "N"])
user_input["welfare_support"] = st.selectbox("ë³µì§€ ì§€ì› ìœ í˜•", [
    "ê¸°ì´ˆìƒí™œìˆ˜ê¸‰ì", "ì˜ë£Œê¸‰ì—¬ ìˆ˜ê¸‰ì", "ì¥ì• ì¸ ì˜ë£Œë¹„ ì§€ì›", "ì¶œì‚° ì˜ë£Œë¹„ ì§€ì›",
    "ì‚°ì¬ ë³´ì¥ ëŒ€ìƒì", "ì‘ê¸‰ì§€ì› ëŒ€ìƒì", "í•´ë‹¹ ì—†ìŒ"
])

if st.button("ì˜ˆìƒ ì§„ë£Œë¹„ ì˜ˆì¸¡í•˜ê¸°"):
    input_df = pd.DataFrame([user_input])
    input_encoded = encoder.transform(input_df)
    prediction = model.predict(input_encoded)[0]

    st.success(f"ğŸ’° ì˜ˆìƒ ì§„ë£Œë¹„ëŠ” ì•½ {int(prediction):,}ì›ì…ë‹ˆë‹¤.")

    if user_input["insurance_covered"] == "Y":
        í™˜ê¸‰ê°€ëŠ¥ = True
        í™˜ê¸‰ë¥  = 0.7
        í™˜ê¸‰ì•¡ = int(prediction * í™˜ê¸‰ë¥ )
        ìê¸°ë¶€ë‹´ = int(prediction - í™˜ê¸‰ì•¡)
    else:
        í™˜ê¸‰ê°€ëŠ¥ = False
        í™˜ê¸‰ì•¡ = 0
        ìê¸°ë¶€ë‹´ = int(prediction)

    st.markdown(f"**ğŸ’¸ ì‹¤ì† ë³´í—˜ ì²­êµ¬ ê°€ëŠ¥ ì—¬ë¶€**: {'ê°€ëŠ¥' if í™˜ê¸‰ê°€ëŠ¥ else 'ë¶ˆê°€ëŠ¥'}")
    st.markdown(f"**ğŸ’° ì˜ˆìƒ í™˜ê¸‰ì•¡**: {í™˜ê¸‰ì•¡:,}ì›")
    st.markdown(f"**ğŸ§¾ ë³¸ì¸ ë¶€ë‹´ ì˜ˆìƒê¸ˆì•¡**: {ìê¸°ë¶€ë‹´:,}ì›")
